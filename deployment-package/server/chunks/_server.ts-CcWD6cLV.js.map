{"version":3,"file":"_server.ts-CcWD6cLV.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/errors/report/_server.ts.js"],"sourcesContent":["import { json } from \"@sveltejs/kit\";\nimport { l as logger, L as LogLevel } from \"../../../../../chunks/logger.js\";\nimport { r as rateLimitErrorReport, c as createErrorResponse, E as ErrorSeverity, a as ErrorType, h as handleApiError } from \"../../../../../chunks/rate-limiter-comprehensive.js\";\nconst POST = async (event) => {\n  const { request, locals } = event;\n  const rateLimitResponse = await rateLimitErrorReport(event);\n  if (rateLimitResponse) {\n    return rateLimitResponse;\n  }\n  try {\n    const reportData = await request.json();\n    if (!reportData.errorId || !reportData.message || !reportData.url) {\n      return json(\n        createErrorResponse(\"Missing required error report fields\", {\n          type: ErrorType.VALIDATION,\n          severity: ErrorSeverity.LOW,\n          requestId: locals.requestId\n        }),\n        { status: 400 }\n      );\n    }\n    const sanitizedReport = {\n      errorId: reportData.errorId.substring(0, 100),\n      // Limit length\n      message: reportData.message.substring(0, 1e3),\n      url: reportData.url.substring(0, 500),\n      userAgent: reportData.userAgent?.substring(0, 500) || \"Unknown\",\n      timestamp: reportData.timestamp,\n      userId: locals.user?.id || reportData.userId,\n      stack: reportData.stack ? reportData.stack.substring(0, 5e3) : void 0,\n      context: reportData.context || {}\n    };\n    logger.logSystem(LogLevel.ERROR, `Client-side error reported: ${sanitizedReport.message}`, {\n      component: \"client-error-reporter\",\n      event: \"client_error_reported\",\n      details: {\n        errorId: sanitizedReport.errorId,\n        url: sanitizedReport.url,\n        userAgent: sanitizedReport.userAgent,\n        userId: sanitizedReport.userId,\n        timestamp: sanitizedReport.timestamp,\n        hasStack: !!sanitizedReport.stack,\n        context: sanitizedReport.context\n      },\n      error: sanitizedReport.stack ? {\n        name: \"ClientError\",\n        message: sanitizedReport.message,\n        stack: sanitizedReport.stack\n      } : void 0\n    });\n    if (sanitizedReport.message.toLowerCase().includes(\"security\") || sanitizedReport.message.toLowerCase().includes(\"unauthorized\") || sanitizedReport.message.toLowerCase().includes(\"csrf\") || sanitizedReport.message.toLowerCase().includes(\"xss\")) {\n      logger.logSecurity(LogLevel.WARN, `Potential security-related client error: ${sanitizedReport.message}`, {\n        eventType: \"client_security_error\",\n        severity: \"medium\",\n        userId: sanitizedReport.userId,\n        ip: request.headers.get(\"cf-connecting-ip\") || request.headers.get(\"x-forwarded-for\") || request.headers.get(\"x-real-ip\"),\n        userAgent: sanitizedReport.userAgent,\n        details: {\n          errorId: sanitizedReport.errorId,\n          url: sanitizedReport.url,\n          context: sanitizedReport.context\n        }\n      });\n    }\n    return json({\n      success: true,\n      message: \"Error report received\",\n      errorId: sanitizedReport.errorId\n    });\n  } catch (error) {\n    return handleApiError(error instanceof Error ? error : new Error(\"Failed to process error report\"), {\n      locals,\n      url: { pathname: \"/api/errors/report\" },\n      request\n    }, {\n      operation: \"error_report_processing\"\n    });\n  }\n};\nexport {\n  POST\n};\n"],"names":[],"mappings":"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"}