{"version":3,"file":"ip-utils-B5dp7ZZG.js","sources":["../../../.svelte-kit/adapter-node/chunks/ip-utils.js"],"sourcesContent":["import { Address4, Address6 } from \"ip-address\";\nfunction extractPublicIP(request) {\n  const headers = request.headers;\n  const xForwardedFor = headers.get(\"x-forwarded-for\");\n  if (xForwardedFor) {\n    const ips = xForwardedFor.split(\",\").map((ip) => ip.trim());\n    const firstIP = ips[0];\n    if (firstIP && isValidIP(firstIP)) {\n      const parsed = parseIP(firstIP);\n      if (parsed && parsed.isPublic) {\n        return {\n          ip: firstIP,\n          source: \"x-forwarded-for\",\n          isPublic: true,\n          version: parsed.version\n        };\n      }\n    }\n  }\n  const xRealIP = headers.get(\"x-real-ip\");\n  if (xRealIP && isValidIP(xRealIP)) {\n    const parsed = parseIP(xRealIP);\n    if (parsed && parsed.isPublic) {\n      return {\n        ip: xRealIP,\n        source: \"x-real-ip\",\n        isPublic: true,\n        version: parsed.version\n      };\n    }\n  }\n  const cfConnectingIP = headers.get(\"cf-connecting-ip\");\n  if (cfConnectingIP && isValidIP(cfConnectingIP)) {\n    const parsed = parseIP(cfConnectingIP);\n    if (parsed && parsed.isPublic) {\n      return {\n        ip: cfConnectingIP,\n        source: \"cf-connecting-ip\",\n        isPublic: true,\n        version: parsed.version\n      };\n    }\n  }\n  return null;\n}\nfunction parseIP(ip) {\n  try {\n    if (Address4.isValid(ip)) {\n      const ipv4 = new Address4(ip);\n      return {\n        version: \"ipv4\",\n        isPublic: !isPrivateIPv4(ipv4)\n      };\n    }\n  } catch (e) {\n  }\n  try {\n    if (Address6.isValid(ip)) {\n      const ipv6 = new Address6(ip);\n      return {\n        version: \"ipv6\",\n        isPublic: !isPrivateIPv6(ipv6)\n      };\n    }\n  } catch (e) {\n  }\n  return null;\n}\nfunction isValidIP(ip) {\n  return parseIP(ip) !== null;\n}\nfunction isPrivateIPv4(addr) {\n  const octets = addr.toArray();\n  if (octets[0] === 10) return true;\n  if (octets[0] === 172 && octets[1] >= 16 && octets[1] <= 31) return true;\n  if (octets[0] === 192 && octets[1] === 168) return true;\n  if (octets[0] === 127) return true;\n  if (octets[0] === 169 && octets[1] === 254) return true;\n  return false;\n}\nfunction isPrivateIPv6(addr) {\n  const address = addr.address.toLowerCase();\n  if (address === \"::1\") return true;\n  if (address.startsWith(\"fc\") || address.startsWith(\"fd\")) return true;\n  if (address.startsWith(\"fe8\") || address.startsWith(\"fe9\") || address.startsWith(\"fea\") || address.startsWith(\"feb\")) return true;\n  if (address.startsWith(\"::ffff:\")) {\n    const ipv4Part = address.substring(7);\n    try {\n      if (Address4.isValid(ipv4Part)) {\n        const ipv4 = new Address4(ipv4Part);\n        return isPrivateIPv4(ipv4);\n      }\n    } catch (e) {\n    }\n  }\n  return false;\n}\nfunction ipToCIDR(ip) {\n  const parsed = parseIP(ip);\n  if (!parsed) return null;\n  if (parsed.version === \"ipv4\") {\n    return `${ip}/32`;\n  } else {\n    return `${ip}/128`;\n  }\n}\nfunction ipInCIDR(ip, cidr) {\n  try {\n    const parsed = parseIP(ip);\n    if (!parsed) return false;\n    if (parsed.version === \"ipv4\") {\n      const ipv4 = new Address4(ip);\n      const cidrAddr = new Address4(cidr);\n      return ipv4.isInSubnet(cidrAddr);\n    } else {\n      const ipv6 = new Address6(ip);\n      const cidrAddr = new Address6(cidr);\n      return ipv6.isInSubnet(cidrAddr);\n    }\n  } catch (e) {\n    return false;\n  }\n}\nfunction isValidCIDR(cidr) {\n  try {\n    if (Address4.isValid(cidr)) return true;\n  } catch (e) {\n  }\n  try {\n    if (Address6.isValid(cidr)) return true;\n  } catch (e) {\n  }\n  return false;\n}\nfunction normalizeCIDR(cidr) {\n  try {\n    if (Address4.isValid(cidr)) {\n      const ipv4 = new Address4(cidr);\n      return ipv4.address;\n    }\n  } catch (e) {\n  }\n  try {\n    if (Address6.isValid(cidr)) {\n      const ipv6 = new Address6(cidr);\n      return ipv6.address;\n    }\n  } catch (e) {\n  }\n  return null;\n}\nfunction getUserAgent(request) {\n  return request.headers.get(\"user-agent\");\n}\nfunction getIPWhitelistConfig() {\n  return {\n    enabled: process.env.IP_WHITELIST_ENABLED === \"true\",\n    mode: process.env.IP_WHITELIST_MODE || \"strict\",\n    adminBypass: process.env.IP_WHITELIST_BYPASS_ADMIN === \"true\",\n    devBypass: process.env.IP_WHITELIST_DEV_BYPASS === \"true\" && process.env.NODE_ENV === \"development\",\n    logAll: process.env.IP_WHITELIST_LOG_ALL === \"true\",\n    cacheTTL: parseInt(process.env.IP_WHITELIST_CACHE_TTL || \"300\")\n    // 5 minutes default\n  };\n}\nexport {\n  ipToCIDR as a,\n  getUserAgent as b,\n  ipInCIDR as c,\n  extractPublicIP as e,\n  getIPWhitelistConfig as g,\n  isValidCIDR as i,\n  normalizeCIDR as n\n};\n"],"names":[],"mappings":"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"}