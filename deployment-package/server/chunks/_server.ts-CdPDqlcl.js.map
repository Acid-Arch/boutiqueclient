{"version":3,"file":"_server.ts-CdPDqlcl.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/health/ready/_server.ts.js"],"sourcesContent":["import { json } from \"@sveltejs/kit\";\nimport { p as prisma } from \"../../../../../chunks/prisma.js\";\nimport { l as logger, L as LogLevel } from \"../../../../../chunks/logger.js\";\nconst GET = async () => {\n  try {\n    const checks = await Promise.allSettled([\n      // Database connectivity\n      prisma.$queryRaw`SELECT 1 as readiness_check`,\n      // Check if essential environment variables are set\n      checkEnvironmentVariables(),\n      // Check if auth system is initialized\n      checkAuthSystem()\n    ]);\n    const results = checks.map((result, index) => ({\n      check: [\"database\", \"environment\", \"auth\"][index],\n      status: result.status === \"fulfilled\" ? \"ready\" : \"not_ready\",\n      reason: result.status === \"rejected\" ? result.reason?.message || \"Unknown error\" : void 0\n    }));\n    const allReady = results.every((result) => result.status === \"ready\");\n    if (allReady) {\n      return json({\n        status: \"ready\",\n        timestamp: (/* @__PURE__ */ new Date()).toISOString(),\n        checks: results\n      }, {\n        status: 200,\n        headers: {\n          \"Cache-Control\": \"no-cache, no-store, must-revalidate\",\n          \"Content-Type\": \"application/json\"\n        }\n      });\n    } else {\n      logger.logSystem(LogLevel.WARN, \"Readiness check failed\", {\n        component: \"readiness-check\",\n        event: \"readiness_failed\",\n        details: {\n          failedChecks: results.filter((r) => r.status === \"not_ready\")\n        }\n      });\n      return json({\n        status: \"not_ready\",\n        timestamp: (/* @__PURE__ */ new Date()).toISOString(),\n        checks: results\n      }, {\n        status: 503,\n        headers: {\n          \"Cache-Control\": \"no-cache, no-store, must-revalidate\",\n          \"Content-Type\": \"application/json\"\n        }\n      });\n    }\n  } catch (error) {\n    logger.logSystem(LogLevel.ERROR, \"Readiness check endpoint failed\", {\n      component: \"readiness-check\",\n      event: \"readiness_check_error\",\n      error: error instanceof Error ? error : void 0\n    });\n    return json({\n      status: \"not_ready\",\n      timestamp: (/* @__PURE__ */ new Date()).toISOString(),\n      error: error instanceof Error ? error.message : \"Unknown error\"\n    }, {\n      status: 503,\n      headers: {\n        \"Cache-Control\": \"no-cache, no-store, must-revalidate\",\n        \"Content-Type\": \"application/json\"\n      }\n    });\n  }\n};\nasync function checkEnvironmentVariables() {\n  const required = [\n    \"DATABASE_URL\",\n    \"AUTH_SECRET\"\n  ];\n  const missing = required.filter((env) => !process.env[env]);\n  if (missing.length > 0) {\n    throw new Error(`Missing required environment variables: ${missing.join(\", \")}`);\n  }\n}\nasync function checkAuthSystem() {\n  if (!process.env.AUTH_SECRET) {\n    throw new Error(\"Auth system not properly configured\");\n  }\n}\nexport {\n  GET\n};\n"],"names":[],"mappings":"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"}