{"version":3,"file":"_server.ts-BUIJA23M.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/avatar/_username_/_server.ts.js"],"sourcesContent":["import { query } from \"../../../../../chunks/db-loader.js\";\nconst GET = async ({ params, url }) => {\n  try {\n    const username = params.username;\n    const size = parseInt(url.searchParams.get(\"size\") || \"80\");\n    if (!username) {\n      return new Response(\"Username required\", { status: 400 });\n    }\n    try {\n      const profileResult = await query(`\n\t\t\t\tSELECT profile_picture_url \n\t\t\t\tFROM account_metrics \n\t\t\t\tWHERE username = $1 \n\t\t\t\tORDER BY scraped_at DESC \n\t\t\t\tLIMIT 1\n\t\t\t`, [username]);\n      if (profileResult?.rows?.[0]?.profile_picture_url) {\n        const profilePictureUrl = profileResult.rows[0].profile_picture_url;\n        if (profilePictureUrl.startsWith(\"http\")) {\n          return new Response(null, {\n            status: 302,\n            headers: {\n              \"Location\": profilePictureUrl,\n              \"Cache-Control\": \"public, max-age=3600\"\n            }\n          });\n        }\n      }\n    } catch (error) {\n      console.log(\"Could not fetch profile picture from database:\", error);\n    }\n    const avatarUrl = `https://api.dicebear.com/7.x/initials/svg?seed=${encodeURIComponent(username)}&size=${size}&backgroundColor=3b82f6&textColor=ffffff`;\n    return new Response(null, {\n      status: 302,\n      headers: {\n        \"Location\": avatarUrl,\n        \"Cache-Control\": \"public, max-age=86400\"\n        // Cache for 24 hours\n      }\n    });\n  } catch (error) {\n    console.error(\"Avatar API error:\", error);\n    const fallbackUrl = `https://api.dicebear.com/7.x/initials/svg?seed=user&size=80&backgroundColor=6b7280&textColor=ffffff`;\n    return new Response(null, {\n      status: 302,\n      headers: {\n        \"Location\": fallbackUrl,\n        \"Cache-Control\": \"public, max-age=3600\"\n      }\n    });\n  }\n};\nexport {\n  GET\n};\n"],"names":[],"mappings":";;;AACK,MAAC,GAAG,GAAG,OAAO,EAAE,MAAM,EAAE,GAAG,EAAE,KAAK;AACvC,EAAE,IAAI;AACN,IAAI,MAAM,QAAQ,GAAG,MAAM,CAAC,QAAQ;AACpC,IAAI,MAAM,IAAI,GAAG,QAAQ,CAAC,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,IAAI,CAAC;AAC/D,IAAI,IAAI,CAAC,QAAQ,EAAE;AACnB,MAAM,OAAO,IAAI,QAAQ,CAAC,mBAAmB,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AAC/D,IAAI;AACJ,IAAI,IAAI;AACR,MAAM,MAAM,aAAa,GAAG,MAAM,KAAK,CAAC;AACxC;AACA;AACA;AACA;AACA;AACA,GAAG,CAAC,EAAE,CAAC,QAAQ,CAAC,CAAC;AACjB,MAAM,IAAI,aAAa,EAAE,IAAI,GAAG,CAAC,CAAC,EAAE,mBAAmB,EAAE;AACzD,QAAQ,MAAM,iBAAiB,GAAG,aAAa,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,mBAAmB;AAC3E,QAAQ,IAAI,iBAAiB,CAAC,UAAU,CAAC,MAAM,CAAC,EAAE;AAClD,UAAU,OAAO,IAAI,QAAQ,CAAC,IAAI,EAAE;AACpC,YAAY,MAAM,EAAE,GAAG;AACvB,YAAY,OAAO,EAAE;AACrB,cAAc,UAAU,EAAE,iBAAiB;AAC3C,cAAc,eAAe,EAAE;AAC/B;AACA,WAAW,CAAC;AACZ,QAAQ;AACR,MAAM;AACN,IAAI,CAAC,CAAC,OAAO,KAAK,EAAE;AACpB,MAAM,OAAO,CAAC,GAAG,CAAC,gDAAgD,EAAE,KAAK,CAAC;AAC1E,IAAI;AACJ,IAAI,MAAM,SAAS,GAAG,CAAC,+CAA+C,EAAE,kBAAkB,CAAC,QAAQ,CAAC,CAAC,MAAM,EAAE,IAAI,CAAC,wCAAwC,CAAC;AAC3J,IAAI,OAAO,IAAI,QAAQ,CAAC,IAAI,EAAE;AAC9B,MAAM,MAAM,EAAE,GAAG;AACjB,MAAM,OAAO,EAAE;AACf,QAAQ,UAAU,EAAE,SAAS;AAC7B,QAAQ,eAAe,EAAE;AACzB;AACA;AACA,KAAK,CAAC;AACN,EAAE,CAAC,CAAC,OAAO,KAAK,EAAE;AAClB,IAAI,OAAO,CAAC,KAAK,CAAC,mBAAmB,EAAE,KAAK,CAAC;AAC7C,IAAI,MAAM,WAAW,GAAG,CAAC,mGAAmG,CAAC;AAC7H,IAAI,OAAO,IAAI,QAAQ,CAAC,IAAI,EAAE;AAC9B,MAAM,MAAM,EAAE,GAAG;AACjB,MAAM,OAAO,EAAE;AACf,QAAQ,UAAU,EAAE,WAAW;AAC/B,QAAQ,eAAe,EAAE;AACzB;AACA,KAAK,CAAC;AACN,EAAE;AACF;;;;"}