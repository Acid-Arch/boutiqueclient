{"version":3,"file":"_server.ts-Cai0MOr3.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/settings/_server.ts.js"],"sourcesContent":["import { json } from \"@sveltejs/kit\";\nimport pg from \"pg\";\nconst PUT = async ({ request, locals }) => {\n  if (!locals.user) {\n    return json({ error: \"Unauthorized\" }, { status: 401 });\n  }\n  try {\n    const settings = await request.json();\n    console.log(`⚙️ Saving settings for user: ${locals.user.email}`, settings);\n    const result = await saveUserSettingsDirectSQL(locals.user, settings);\n    if (result.success) {\n      return json({\n        success: true,\n        message: \"Settings saved successfully\",\n        settings: result.settings\n      });\n    } else {\n      return json({ error: \"Failed to save settings\" }, { status: 500 });\n    }\n  } catch (error) {\n    console.error(\"Error saving settings:\", error);\n    return json({ error: \"Internal server error\" }, { status: 500 });\n  }\n};\nasync function saveUserSettingsDirectSQL(user, settings) {\n  const { Client } = pg;\n  const client = new Client({\n    connectionString: process.env.DATABASE_URL || \"postgresql://iglogin:boutiquepassword123@5.78.151.248:5432/igloginagent?sslmode=disable&connect_timeout=30\"\n  });\n  try {\n    await client.connect();\n    const updateQuery = `\n\t\t\tUPDATE users \n\t\t\tSET \n\t\t\t\tname = $2,\n\t\t\t\tcompany = $3,\n\t\t\t\tupdated_at = NOW()\n\t\t\tWHERE id = $1 OR email = $4\n\t\t\tRETURNING id, name, email, company, role, updated_at\n\t\t`;\n    const result = await client.query(updateQuery, [\n      user.id,\n      settings.profile?.name || user.name,\n      settings.profile?.company || \"\",\n      user.email\n    ]);\n    if (result.rows.length > 0) {\n      const updatedUser = result.rows[0];\n      console.log(`✅ Settings updated for user: ${user.email}`);\n      return {\n        success: true,\n        settings: {\n          profile: {\n            name: updatedUser.name,\n            email: updatedUser.email,\n            company: updatedUser.company,\n            role: updatedUser.role\n          },\n          lastUpdated: updatedUser.updated_at\n        }\n      };\n    } else {\n      console.log(`❌ No user found to update: ${user.email}`);\n      return { success: false };\n    }\n  } catch (sqlError) {\n    console.error(\"Failed to save settings via direct SQL:\", sqlError);\n    return { success: false };\n  } finally {\n    await client.end();\n  }\n}\nexport {\n  PUT\n};\n"],"names":[],"mappings":"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"}