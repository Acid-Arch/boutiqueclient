{"version":3,"file":"_server.ts-OoAPUwvs.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/accounts/_id_/field/_server.ts.js"],"sourcesContent":["import { json } from \"@sveltejs/kit\";\nimport { getAccountById, updateAccount } from \"../../../../../../chunks/db-loader.js\";\nimport { A as ACCOUNT_STATUSES } from \"../../../../../../chunks/status.js\";\nconst PATCH = async ({ params, request }) => {\n  try {\n    const id = parseInt(params.id);\n    if (isNaN(id)) {\n      return json({\n        success: false,\n        error: \"Invalid account ID\"\n      }, { status: 400 });\n    }\n    const existingAccount = await getAccountById(id);\n    if (!existingAccount) {\n      return json({\n        success: false,\n        error: \"Account not found\"\n      }, { status: 404 });\n    }\n    const { field, value } = await request.json();\n    if (!field) {\n      return json({\n        success: false,\n        error: \"Field name is required\"\n      }, { status: 400 });\n    }\n    const updateData = {};\n    let validationError = null;\n    switch (field) {\n      case \"status\":\n        if (!ACCOUNT_STATUSES.includes(value)) {\n          validationError = \"Invalid status value\";\n        } else {\n          updateData.status = value;\n          if (value === \"Logged In\") {\n            updateData.loginTimestamp = /* @__PURE__ */ new Date();\n          }\n        }\n        break;\n      case \"assignedDeviceId\":\n        updateData.assignedDeviceId = value || null;\n        if (value) {\n          updateData.assignmentTimestamp = /* @__PURE__ */ new Date();\n        } else {\n          updateData.assignedCloneNumber = null;\n          updateData.assignedPackageName = null;\n          updateData.assignmentTimestamp = null;\n        }\n        break;\n      case \"assignedCloneNumber\":\n        if (value !== null && (isNaN(value) || value < 1 || value > 32)) {\n          validationError = \"Clone number must be between 1 and 32\";\n        } else {\n          updateData.assignedCloneNumber = value;\n        }\n        break;\n      case \"imapStatus\":\n        if (![\"On\", \"Off\"].includes(value)) {\n          validationError = \"IMAP status must be On or Off\";\n        } else {\n          updateData.imapStatus = value;\n        }\n        break;\n      case \"instagramUsername\":\n        if (!value || value.length < 3) {\n          validationError = \"Instagram username must be at least 3 characters\";\n        } else {\n          updateData.instagramUsername = value;\n        }\n        break;\n      case \"emailAddress\":\n        if (!value || !/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(value)) {\n          validationError = \"Please enter a valid email address\";\n        } else {\n          updateData.emailAddress = value;\n        }\n        break;\n      case \"recordId\":\n        updateData.recordId = value;\n        break;\n      default:\n        validationError = `Field '${field}' is not allowed for updates`;\n    }\n    if (validationError) {\n      return json({\n        success: false,\n        error: validationError\n      }, { status: 400 });\n    }\n    const updatedAccount = await updateAccount(id, updateData);\n    return json({\n      success: true,\n      data: updatedAccount,\n      field,\n      value\n    });\n  } catch (error) {\n    console.error(\"Failed to update account field:\", error);\n    return json({\n      success: false,\n      error: \"Failed to update account field\"\n    }, { status: 500 });\n  }\n};\nexport {\n  PATCH\n};\n"],"names":[],"mappings":"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"}