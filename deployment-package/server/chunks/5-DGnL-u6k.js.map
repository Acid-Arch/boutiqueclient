{"version":3,"file":"5-DGnL-u6k.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/client-portal/analytics/_page.server.ts.js","../../../.svelte-kit/adapter-node/nodes/5.js"],"sourcesContent":["import { l as logUserModelAccess } from \"../../../../chunks/model-access.js\";\nimport pg from \"pg\";\nasync function getAccountsWithModelAccess(user) {\n  const { Client } = pg;\n  const client = new Client({\n    connectionString: process.env.DATABASE_URL || \"postgresql://iglogin:boutiquepassword123@5.78.151.248:5432/igloginagent?sslmode=disable&connect_timeout=30\"\n  });\n  try {\n    await client.connect();\n    let modelFilter = \"\";\n    const queryParams = [user.id];\n    if (user.email && user.email.includes(\"@gmail.com\")) {\n      modelFilter = `OR (model = 'Dillion' AND (account_type != 'ML_TREND_FINDER' OR account_type IS NULL))`;\n      console.log(`ðŸ”‘ SQL: Adding Dillion model access for Gmail user: ${user.email}`);\n    }\n    if (user.email && (user.email.includes(\"@hotmail.\") || user.email.includes(\"@live.\") || user.email.includes(\"@outlook.\"))) {\n      modelFilter = `OR (model = 'katie' AND (account_type != 'ML_TREND_FINDER' OR account_type IS NULL))`;\n      console.log(`ðŸ”‘ SQL: Adding katie model access for Hotmail user: ${user.email}`);\n    }\n    const accountsQuery = `\n\t\t\tSELECT \n\t\t\t\tid, instagram_username, instagram_password, email_address, email_password,\n\t\t\t\tstatus, imap_status, assigned_device_id, assigned_clone_number, assigned_package_name,\n\t\t\t\tassignment_timestamp, login_timestamp, created_at, updated_at,\n\t\t\t\towner_id, account_type, visibility, is_shared, model,\n\t\t\t\tfollower_count, following_count, post_count, total_engagement, engagement_rate,\n\t\t\t\tfollower_growth_30d, engagement_growth_30d, last_scraped_at\n\t\t\tFROM ig_accounts \n\t\t\tWHERE (\n\t\t\t\t(owner_id = $1 AND (account_type != 'ML_TREND_FINDER' OR account_type IS NULL))\n\t\t\t\tOR \n\t\t\t\t(is_shared = true AND visibility IN ('SHARED', 'PUBLIC') AND (account_type != 'ML_TREND_FINDER' OR account_type IS NULL))\n\t\t\t\t${modelFilter}\n\t\t\t)\n\t\t\tORDER BY created_at DESC \n\t\t\tLIMIT 1000\n\t\t`;\n    const result = await client.query(accountsQuery, queryParams);\n    const accounts = result.rows.map((row) => ({\n      id: row.id,\n      recordId: row.record_id,\n      instagramUsername: row.instagram_username,\n      instagramPassword: row.instagram_password,\n      emailAddress: row.email_address,\n      emailPassword: row.email_password,\n      status: row.status,\n      imapStatus: row.imap_status,\n      assignedDeviceId: row.assigned_device_id,\n      assignedCloneNumber: row.assigned_clone_number,\n      assignedPackageName: row.assigned_package_name,\n      assignmentTimestamp: row.assignment_timestamp,\n      loginTimestamp: row.login_timestamp,\n      createdAt: row.created_at,\n      updatedAt: row.updated_at,\n      ownerId: row.owner_id,\n      accountType: row.account_type,\n      visibility: row.visibility,\n      isShared: row.is_shared,\n      model: row.model,\n      followerCount: row.follower_count,\n      followingCount: row.following_count,\n      postCount: row.post_count,\n      totalEngagement: row.total_engagement,\n      engagementRate: parseFloat(row.engagement_rate || 0),\n      followerGrowth30d: row.follower_growth_30d,\n      engagementGrowth30d: parseFloat(row.engagement_growth_30d || 0),\n      lastScrapedAt: row.last_scraped_at\n    }));\n    return { accounts, totalCount: accounts.length };\n  } finally {\n    await client.end();\n  }\n}\nconst load = async ({ locals }) => {\n  if (!locals.user) {\n    return {\n      analytics: {\n        totalFollowers: 0,\n        totalEngagement: 0,\n        avgEngagementRate: 0,\n        totalPosts: 0,\n        followerGrowth: 0,\n        engagementGrowth: 0,\n        accounts: []\n      }\n    };\n  }\n  try {\n    logUserModelAccess(locals.user);\n    const { accounts } = await getAccountsWithModelAccess(locals.user);\n    console.log(`ðŸ“Š Analytics: Found ${accounts.length} accounts for user ${locals.user.email}`);\n    const analytics = {\n      totalFollowers: calculateTotalFollowers(accounts),\n      totalEngagement: calculateTotalEngagement(accounts),\n      avgEngagementRate: calculateEngagementRate(accounts),\n      totalPosts: calculateTotalPosts(accounts),\n      followerGrowth: calculateFollowerGrowth(accounts),\n      engagementGrowth: calculateEngagementGrowth(accounts),\n      accounts: accounts.slice(0, 20)\n      // Limit for analytics display\n    };\n    console.log(`ðŸ“ˆ Analytics stats: ${analytics.totalFollowers} followers, ${analytics.totalPosts} posts, ${analytics.avgEngagementRate}% engagement`);\n    return { analytics };\n  } catch (error) {\n    console.error(\"Error loading analytics data:\", error);\n    return {\n      analytics: {\n        totalFollowers: 0,\n        totalEngagement: 0,\n        avgEngagementRate: 0,\n        totalPosts: 0,\n        followerGrowth: 0,\n        engagementGrowth: 0,\n        accounts: []\n      }\n    };\n  }\n};\nfunction calculateTotalFollowers(accounts) {\n  return accounts.reduce((total, acc) => {\n    return total + (acc.followerCount || 0);\n  }, 0);\n}\nfunction calculateTotalEngagement(accounts) {\n  return accounts.reduce((total, acc) => {\n    return total + (acc.totalEngagement || 0);\n  }, 0);\n}\nfunction calculateEngagementRate(accounts) {\n  if (accounts.length === 0) return 0;\n  const accountsWithData = accounts.filter((acc) => acc.engagementRate && acc.engagementRate > 0);\n  if (accountsWithData.length === 0) return 0;\n  const totalRate = accountsWithData.reduce((sum, acc) => sum + acc.engagementRate, 0);\n  return Math.round(totalRate / accountsWithData.length * 100) / 100;\n}\nfunction calculateTotalPosts(accounts) {\n  return accounts.reduce((total, acc) => {\n    return total + (acc.postCount || 0);\n  }, 0);\n}\nfunction calculateFollowerGrowth(accounts) {\n  if (accounts.length === 0) return 0;\n  const accountsWithGrowthData = accounts.filter(\n    (acc) => typeof acc.followerGrowth30d === \"number\"\n  );\n  if (accountsWithGrowthData.length === 0) return 0;\n  const totalGrowth = accountsWithGrowthData.reduce((sum, acc) => sum + acc.followerGrowth30d, 0);\n  const totalFollowers = accountsWithGrowthData.reduce((sum, acc) => sum + (acc.followerCount || 1), 0);\n  return Math.round(totalGrowth / totalFollowers * 100 * 10) / 10;\n}\nfunction calculateEngagementGrowth(accounts) {\n  if (accounts.length === 0) return 0;\n  const accountsWithEngagementGrowth = accounts.filter(\n    (acc) => typeof acc.engagementGrowth30d === \"number\"\n  );\n  if (accountsWithEngagementGrowth.length === 0) return 0;\n  const totalGrowth = accountsWithEngagementGrowth.reduce((sum, acc) => sum + acc.engagementGrowth30d, 0);\n  return Math.round(totalGrowth / accountsWithEngagementGrowth.length * 100) / 100;\n}\nexport {\n  load\n};\n","import * as server from '../entries/pages/client-portal/analytics/_page.server.ts.js';\n\nexport const index = 5;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/client-portal/analytics/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/client-portal/analytics/+page.server.ts\";\nexport const imports = [\"_app/immutable/nodes/5.DwD9ztFQ.js\",\"_app/immutable/chunks/DsnmJJEf.js\",\"_app/immutable/chunks/DX-Oc8op.js\",\"_app/immutable/chunks/3zx2OM-S.js\",\"_app/immutable/chunks/Dwjkgfq3.js\",\"_app/immutable/chunks/BrzuSUaY.js\",\"_app/immutable/chunks/lPcixCUF.js\",\"_app/immutable/chunks/Bwnq7jH9.js\",\"_app/immutable/chunks/BID1lDIu.js\",\"_app/immutable/chunks/z8oQ6GeD.js\",\"_app/immutable/chunks/Dx4riVje.js\",\"_app/immutable/chunks/BAf6IcXK.js\",\"_app/immutable/chunks/Dcut3OIX.js\",\"_app/immutable/chunks/C0A-HqK_.js\"];\nexport const stylesheets = [];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}