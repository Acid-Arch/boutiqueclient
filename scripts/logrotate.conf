# Logrotate configuration for Boutique Client Portal
# Copy to /etc/logrotate.d/boutique-portal

# Application logs (PM2 generated)
/home/george/dev/boutiqueclient/logs/*.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 644 george george
    postrotate
        # Reload PM2 logs
        /usr/bin/pm2 flush boutique-client-portal 2>/dev/null || true
        /usr/bin/pm2 reloadLogs 2>/dev/null || true
    endscript
}

# Nginx logs (if using our Nginx config)
/var/log/nginx/boutique-portal.*.log {
    daily
    rotate 52
    compress
    delaycompress
    missingok
    notifempty
    create 644 www-data adm
    sharedscripts
    postrotate
        if [ -f /var/run/nginx.pid ]; then
            /bin/kill -USR1 `cat /var/run/nginx.pid`
        fi
    endscript
}

# System service logs
/home/george/dev/boutiqueclient/logs/systemd-*.log {
    weekly
    rotate 12
    compress
    delaycompress
    missingok
    notifempty
    create 644 george george
    postrotate
        /bin/systemctl reload boutique-portal 2>/dev/null || true
    endscript
}

# Database backup logs
/home/george/dev/boutiqueclient/logs/database-backup.log {
    weekly
    rotate 12
    compress
    delaycompress
    missingok
    notifempty
    create 644 george george
}

# WebSocket logs
/home/george/dev/boutiqueclient/logs/websocket-*.log {
    daily
    rotate 14
    compress
    delaycompress
    missingok
    notifempty
    create 644 george george
    postrotate
        /usr/bin/pm2 flush boutique-websocket-server 2>/dev/null || true
    endscript
}